class Object2d{defaultDrawer;colorOverrides;constructor(config){if(config.parent?.isRemoved)return console.error("Cannot instantiate, parent is removed.",config),!1;if(!config.drawer){if(!Object2d.defaultDrawer)return console.log("no default drawer"),!1;config.drawer=Object2d.defaultDrawer}this.x="50%",this.y="50%",this.rotation=0,this.imageSrc="";for(let key of Object.keys(config))this[key]=config[key];this.config=config,this.config.onClick&&(this.onClick=()=>{App.mouse.isDown=!1,App.preventNextGameplayControl=!0,App.playSound("resources/sounds/ui_click_06.ogg",!0),App.vibrate(),this.config.onClick?.()}),this.image?this.setImage(this.image.cloneNode(!0)):(this.image=new Image,this.setImg(config.img)),this.id=this.drawer.addObject(this)}setImg(img,forced){if(!img)return;if(this.imageSrc===img&&!forced)return;const preloaded=App.preloadedResources[img];if(preloaded&&!this.noPreload)return this.setImage(this.applyColorOverrides(preloaded));this.imageSrc=img,this.image.src=App.checkResourceOverride(img),this.image.onload=()=>{this.image=this.applyColorOverrides(this.image)}}setImage(image){this.imageSrc=image.src,this.image=image,this.image.src=App.checkResourceOverride(this.image.src),this.image.onload=()=>{this.image=this.applyColorOverrides(this.image)}}applyColorOverrides(image){const allColorOverrides=[...Object2d.colorOverrides??[],...this.colorOverrides??[]];return allColorOverrides.length?recolorImage(image,allColorOverrides):image}removeObject(){this.drawer?.removeObject?.(this)}mimicParent(ignoreList=[]){function should(val){return!ignoreList.includes(val)}this.parent&&(should("x")&&(this.x=this.parent.x),should("y")&&(this.y=this.parent.y+this.parent.additionalY),should("inverted")&&(this.inverted=this.parent.inverted),should("upperHalfOffsetY")&&(this.upperHalfOffsetY=this.parent.upperHalfOffsetY),should("scale")&&(this.scale=this.parent.scale),should("opacity")&&(this.opacity=this.parent.opacity),should("spritesheet")&&this.spritesheet&&(this.spritesheet.cellNumber=this.parent.spritesheet.cellNumber))}stopMove(){this.targetX=void 0,this.targetY=void 0}moveToTarget(speed=.01){const shouldMoveX=void 0!==this.targetX&&this.targetX!=this.x,shouldMoveY=void 0!==this.targetY&&this.targetY!=this.y;let currentSpeed=shouldMoveX&&shouldMoveY?speed/2:speed;shouldMoveX?(this.isMoving=!0,this.x>this.targetX?this.moveLeft(this.targetX,currentSpeed):this.x<this.targetX&&this.moveRight(this.targetX,currentSpeed)):this.isMoving=!1,shouldMoveY&&(this.y>this.targetY?this.moveUp(this.targetY,currentSpeed):this.y<this.targetY&&this.moveDown(this.targetY,currentSpeed))}moveRight(maxX,speed){const velocity=this.x+speed*App.deltaTime;this.x=velocity>maxX?maxX:velocity,this.inverted=!0}moveLeft(minX,speed){const velocity=this.x-speed*App.deltaTime;this.x=velocity<minX?minX:velocity,this.inverted=!1}moveUp(minY,speed){const velocity=this.y-2*speed*App.deltaTime;this.y=velocity<minY?minY:velocity}moveDown(maxY,speed){const velocity=this.y+2*speed*App.deltaTime;this.y=velocity>maxY?maxY:velocity}showBoundingBox(shrinkX,shrinkY){const parent=this;if(!this.boundingBoxElement){this.boundingBoxElement=new Object2d({parent:parent,img:"resources/img/misc/red_pixel.png",opacity:.25,onDraw:me=>{const bb=parent.getBoundingBox(shrinkX,shrinkY);me.x=bb.x,me.y=bb.y,me.width=bb.width,me.height=bb.height}});new Object2d({img:"resources/img/misc/red_pixel.png",x:0,y:0,z:999,parent:this.boundingBoxElement,onDraw:me=>{me.x=me.parent.x,me.y=me.parent.y+me.parent.height,me.width=me.parent.width}})}}hideBoundingBox(){this.boundingBoxElement?.removeObject?.(),this.boundingBoxElement=null}getBoundingBox(shrinkX=0,shrinkY=0){const scale=this.scale??1,baseWidth=this.spritesheet?.cellSize||this.width||this.image.width,baseHeight=this.spritesheet?.cellSize||this.height||this.image.height,width=(baseWidth-2*shrinkX)*scale,height=(baseHeight-2*shrinkY)*scale;return{x:this.x+(this.additionalX||0)-(width-(baseWidth-2*shrinkX))/2,y:this.y+(this.additionalY||0)-(height-(baseHeight-2*shrinkY))/2,width:width,height:height}}isColliding(otherBoundingBox){const currentBoundingBox=this.getBoundingBox();return Object2d.checkAabbCollision(currentBoundingBox,otherBoundingBox)}showOutline(color="#7CE0E6",setAsInitial){setAsInitial||null==this._initialFilter&&(this._initialFilter=this.filter||"");const outlineFilter=[`drop-shadow(0px 1px 0px ${color})`,`drop-shadow(1px 0px 0px ${color})`,`drop-shadow(-1px 0px 0px ${color})`].join(" ");this.filter=`${this._initialFilter||""} ${outlineFilter}`.trim()}hideOutline(){this.filter=null!=this._initialFilter?this._initialFilter:this.filter,this._initialFilter=this.filter}static setColorOverrides(colors){Object2d.colorOverrides=colors}static setDrawer(drawer){Object2d.defaultDrawer=drawer}static animations={flip:function(me,flipTime){flipTime||(flipTime=300),(!me.nextFlipMs||App.time>me.nextFlipMs)&&(me.inverted=!me.inverted,me.nextFlipMs=App.time+flipTime)},bob:function(me,bobSpeed,bobStrength){bobSpeed||(bobSpeed=.01),bobStrength||(bobStrength=.4),(!me.bobFloat||me.bobFloat>App.PI2)&&(me.bobFloat=0),me.bobFloat+=bobSpeed*App.deltaTime;const currentFloat=Math.sin(me.bobFloat)*bobStrength;me.y+=currentFloat},pixelBreath:function(me,speed,diffPixels){diffPixels||(diffPixels=1),speed||(speed=.00145),void 0===me.currentOffset&&(me.currentOffset=0),(!me.breathFloat||me.breathFloat>1)&&(me.breathFloat=0,me.breathState=!me.breathState,me.breathState?me.currentOffset=diffPixels:me.currentOffset=0,me.upperHalfOffsetY=me.currentOffset),me.breathFloat+=speed*App.deltaTime},circleAround:function(me,radius,deg,originX,originY){let y=-Math.ceil(radius*Math.cos(deg)),x=Math.ceil(radius*Math.sin(deg));me.x=originX+x,me.y=originY+y},pulseScale:function(me,speed,strength){me.scale||(me.scale=1),speed||(speed=.01),strength||(strength=.4),(!me.pulseScaleFloat||me.pulseScaleFloat>=App.PI2)&&(me.pulseScaleFloat=0),me.pulseScaleFloat+=speed*App.deltaTime;let currentFloat=Math.sin(me.pulseScaleFloat)*strength;me.scale+=currentFloat},rotateAround:function(me,speed){speed||(speed=.05),me.rotateAroundFloat||(me.rotateAroundFloat=0),me.rotation+=speed*App.deltaTime},cycleThroughFrames:function(me,delay=250,alternateDirection){if(!me.spritesheet)return;const maxCells=me.spritesheet.rows*me.spritesheet.columns;if(me._cycleThroughFrames||(me._cycleThroughFrames={nextTime:0,adder:1}),me._cycleThroughFrames.nextTime<App.time){const{cellNumber:cellNumber}=me.spritesheet,{adder:adder}=me._cycleThroughFrames;alternateDirection?((cellNumber+adder>=maxCells||cellNumber+adder<=1)&&(me._cycleThroughFrames.adder*=-1),me.spritesheet.cellNumber+=adder):cellNumber+adder>maxCells?me.spritesheet.cellNumber=1:me.spritesheet.cellNumber+=adder,me._cycleThroughFrames.nextTime=App.time+delay}}};static actionAnimations={horizontalJiggle:(object,{speed:speed=.03,strength:strength=3,cycles:cycles=1}={})=>{const originX=object.x;let movementFloat=0,currentCycle=0;const frameEvent=App.registerOnDrawEvent(()=>{if(movementFloat+=speed*App.deltaTime,movementFloat>Math.PI&&(movementFloat=0,++currentCycle>cycles))return object.x=originX,void App.unregisterOnDrawEvent(frameEvent);object.x=originX+Math.sin(movementFloat)*strength})}};static checkAabbCollision(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}}